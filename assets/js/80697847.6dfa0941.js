"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2472],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return u}});var o=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=o.createContext({}),c=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=c(e.components);return o.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(n),u=i,h=d["".concat(l,".").concat(u)]||d[u]||m[u]||r;return n?o.createElement(h,a(a({ref:t},p),{},{components:n})):o.createElement(h,a({ref:t},p))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,a=new Array(r);a[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,a[1]=s;for(var c=2;c<r;c++)a[c]=n[c];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6356:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return p},default:function(){return d}});var o=n(3117),i=n(102),r=(n(7294),n(3905)),a=["components"],s={id:"units",title:"Unit testing",sidebar_label:"Unit testing"},l=void 0,c={unversionedId:"testing/units",id:"version-5.x/testing/units",title:"Unit testing",description:"As microfrontends gain widespread adoption, testing tools will catch up and the testing story will improve.",source:"@site/versioned_docs/version-5.x/testing/units.md",sourceDirName:"testing",slug:"/testing/units",permalink:"/docs/testing/units",editUrl:"https://github.com/single-spa/fr.single-spa.js.org/blob/master/website/versioned_docs/version-5.x/testing/units.md",tags:[],version:"5.x",frontMatter:{id:"units",title:"Unit testing",sidebar_label:"Unit testing"},sidebar:"version-5.x/docs",previous:{title:"Overview",permalink:"/docs/parcels-overview"},next:{title:"E2E testing",permalink:"/docs/testing/e2e"}},p=[{value:"Importing microfrontends",id:"importing-microfrontends",children:[],level:2},{value:"<code>System.import</code>",id:"systemimport",children:[],level:2},{value:"Shared Mocks",id:"shared-mocks",children:[],level:2},{value:"Testing examples",id:"testing-examples",children:[{value:"Jest",id:"jest",children:[{value:"Jest config",id:"jest-config",children:[],level:4},{value:"mocks directory",id:"mocks-directory",children:[],level:4},{value:"setup file",id:"setup-file",children:[],level:4}],level:3}],level:2}],m={toc:p};function d(e){var t=e.components,n=(0,i.Z)(e,a);return(0,r.kt)("wrapper",(0,o.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"As microfrontends gain widespread adoption, testing tools will catch up and the testing story will improve."))),(0,r.kt)("p",null,"Unit testing a single-spa ",(0,r.kt)("a",{parentName:"p",href:"/docs/module-types#applications"},"application"),", ",(0,r.kt)("a",{parentName:"p",href:"/docs/module-types#parcels"},"parcel"),", or ",(0,r.kt)("a",{parentName:"p",href:"/docs/module-types/#utilities"},"utility")," is very similar to unit testing in the framework you are using, with two notable exceptions:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Importing microfrontends"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"System.import"))),(0,r.kt)("p",null,"In general we recommend following the principle of only testing the units that need to be tested and aren't covered by other tests. Testing library code like ",(0,r.kt)("inlineCode",{parentName:"p"},"single-spa.registerApplication")," is usually unnecessary because those are covered by the library's unit tests."),(0,r.kt)("h2",{id:"importing-microfrontends"},"Importing microfrontends"),(0,r.kt)("p",null,"It is fairly common in microfrontends to have one microfrontend import and rely upon a component from another microfrontend. Reliance on another microfrontend can be challenging to test because unit tests generally run locally and you won't have access to other microfrontends. When this occurs we generally recommend mocking the other microfrontend for the unit test."),(0,r.kt)("p",null,"An example of this can be found in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Button")," component exported by the ",(0,r.kt)("inlineCode",{parentName:"p"},"styleguide")," in ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/react-microfrontends/styleguide/blob/master/src/button.component.js"},"react.microfrontends.app"),". Because that component is imported and used by the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/react-microfrontends/planets/blob/41ba0aaf9005b5300cc28ad5f4eac024eae06e2b/src/planets-page/planets-page.component.js#L6"},"planets application")," you will need to make it available to the test environment by mocking the dependency. This is necessary because the test environment cannot dynamically import other microfrontends, like the browser can. Given the wide variety of unit testing tools you will need to follow the pattern established by the test environment you are using for mocking other microfrontends."),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"We suggest mocks over installing microfrontends for local tests (for example via NPM modules) because mocks are easier to maintain and avoid several potential incompatiblity issues such as version mismatch, module format incompatibility, environment differences, and more."))),(0,r.kt)("h2",{id:"systemimport"},(0,r.kt)("inlineCode",{parentName:"h2"},"System.import")),(0,r.kt)("p",null,"Occasionally you will choose to interop with another microfrontend asynchronously by explicitly calling ",(0,r.kt)("inlineCode",{parentName:"p"},"System.import"),". Testing in this scenairo may require mocking both SystemJS and the module you're importing. Additionally because ",(0,r.kt)("inlineCode",{parentName:"p"},"System.import")," returns a promise your tests in that area will need to be asynchronous and wait for promises to resolve."),(0,r.kt)("p",null,"An example of this can be found in ",(0,r.kt)("inlineCode",{parentName:"p"},"people")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"planets")," applications from ",(0,r.kt)("inlineCode",{parentName:"p"},"react.microfrontends.app"),". The ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/react-microfrontends/people/blob/master/src/react-mf-people.js#L21"},"People application")," exports a function that resolves with a component. The ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/react-microfrontends/planets/blob/main/src/planets-page/selected-planet/selected-planet.component.js"},"Planets Application")," imports and uses that component asynchronously with ",(0,r.kt)("inlineCode",{parentName:"p"},"React.lazy"),". Testing this component would necessitate mocking both ",(0,r.kt)("inlineCode",{parentName:"p"},"SystemJS")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"People"),"."),(0,r.kt)("h2",{id:"shared-mocks"},"Shared Mocks"),(0,r.kt)("p",null,"If each project mocks every other microfrontend it is possible that the mocks will eventually become out of sync with the actual deployed microfrontend. One way to prevent this is to share mocks so that keeping the mocks in sync only requires one change instead of updating mocks in many different repositories."),(0,r.kt)("h2",{id:"testing-examples"},"Testing examples"),(0,r.kt)("h3",{id:"jest"},"Jest"),(0,r.kt)("p",null,"In the above examples I showed how ",(0,r.kt)("inlineCode",{parentName:"p"},"People")," imports a component from ",(0,r.kt)("inlineCode",{parentName:"p"},"styleguide"),". In order to unit test the component in people with Jest you will need to ",(0,r.kt)("a",{parentName:"p",href:"https://jestjs.io/docs/configuration"},"configure")," jest and mock the ",(0,r.kt)("inlineCode",{parentName:"p"},"styleguide")," MFE. In jest configuration is done via multiple areas."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#jest-config"},"Create a jest config file")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#mocks-directory"},"Setup a mocks directory at the root")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#setup-file"},"Add a setupFile"))),(0,r.kt)("h4",{id:"jest-config"},"Jest config"),(0,r.kt)("p",null,"Jest is configured with a configuration file. Below is an example configuration using some of the options. See ",(0,r.kt)("a",{parentName:"p",href:"https://jestjs.io/docs/configuration"},"more options on Jest's official documentation site"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = {\n  collectCoverageFrom: ['src/**/*.js'],\n  modulePathIgnorePatterns: ['/cache', '/dist'],\n  transform: {\n    '^.+\\\\.(j|t)sx?$': 'babel-jest',\n  },\n  setupFilesAfterEnv: ['./jest.setup.js'],\n  moduleNameMapper: {\n    // Note this is only needed if you don't match the module name directly\n    // an alternative would be to place the mock in \n    // <rootDir>/__mocks__/@react-mf/styleguide.js and it would be autodetected\n    '@react-mf/styleguide': '<rootDir>/__mocks__/styleguide.js',\n  },\n}\n")),(0,r.kt)("h4",{id:"mocks-directory"},"mocks directory"),(0,r.kt)("p",null,"Jest will detect folders named ",(0,r.kt)("inlineCode",{parentName:"p"},"__mocks__")," and if the naming convention is exact or the modules have been mapped using ",(0,r.kt)("inlineCode",{parentName:"p"},"moduleNameMapper")," then Jest will use those mocks in place of an import. This structure is essential for other microfrontends where you don't have the code locally. ",(0,r.kt)("a",{parentName:"p",href:"https://jestjs.io/docs/manual-mocks"},"See more information on jest's official documentation")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},".\n\u251c\u2500\u2500 __mocks__\n\u2502   \u2514\u2500\u2500 styleguide.js\n\u251c\u2500\u2500 src\n\u2502   \u251c\u2500\u2500 react-mf-people.js\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 node_modules\n\u251c\u2500\u2500 jest.setup.js\n\u251c\u2500\u2500 ...\n\u2514\u2500\u2500 jest.config.js\n")),(0,r.kt)("h4",{id:"setup-file"},"setup file"),(0,r.kt)("p",null,"Jest uses a setup file to create globals mocks that can be utilized by every test or otherwise configure the test environment. If you were mocking ",(0,r.kt)("inlineCode",{parentName:"p"},"localStorage")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"SystemJS")," this is a good place to configure those mocks. ",(0,r.kt)("a",{parentName:"p",href:"https://jestjs.io/docs/configuration#setupfilesafterenv-array"},"See more use-cases for a set-up file on Jest's offical documentation")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// jest.setup.js\n// import Mocks for SystemJS mock below\nimport peopleApplication from '@react-mf/people'\n// Mock SystemJS\nglobal.System = {\n  import: jest.fn(mockImport)\n}\n\nfunction mockImport (importName) {\n  // What you do in mock import will depend a lot on how you use SystemJS in the project and components you wish to test\n\n  /* If I had already created a mock for `@react-mf/people` and I wanted to test this component:\n  *  https://github.com/react-microfrontends/planets/blob/main/src/planets-page/selected-planet/selected-planet.component.js#L5\n  * I would want `System.import('@react-mf/people')` to resovle to my mock one way to accomplish this would be the following\n  */\n  if (importName === '@react-mf/people') {\n    return Promise.resolve(peopleApplication)\n  } else {\n    console.warn('No mock module found')\n    return Promise.resolve({})\n  }\n}\n\n")))}d.isMDXComponent=!0}}]);